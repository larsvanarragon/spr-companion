<script type="text/javascript">
    var loadedTikzJax = false;
    var tikzJaxBusy = false;

    // Anonymous "self-invoking" function
    (function() {
        var startingTime = new Date().getTime();
        // Load the script
        var script = document.createElement("SCRIPT");
        script.src = 'http://tikzjax.com/v1/tikzjax.js';
        script.type = 'text/javascript';
        script.onload = function() {
            var $ = window.jQuery;
        $(function() {
                var endingTime = new Date().getTime();
                var tookTime = endingTime - startingTime;
                loadedTikzJax = true;
                console.log("Loaded TikzJax in " + tookTime + " milliseconds!");
            });
        };
        document.getElementsByTagName("head")[0].appendChild(script);
    })();

    $('body').on("DOMSubtreeModified", function() {
        // Rerender Latex
        MathJax.Hub.Queue(["Typeset", MathJax.Hub, this]);

        // Possibly rerender Tikz Latex
        var scripts = document.getElementsByTagName('script');
        var tikzScripts = Array.prototype.slice.call(scripts).filter(
            (e) => (e.getAttribute('type') === 'text/tikz'));
        
        if (tikzScripts.length > 0 && loadedTikzJax && !tikzJaxBusy) {
            tikzJaxBusy = true;
            doExecuteTikz();
        }
    });

    async function doExecuteTikz() {
        await window.onload();
        tikzJaxBusy = false;    
    }
</script>
